<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Architecture Roles Display</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9; /* Light gray background */
            color: #334155; /* Slate-700 for general text */
            line-height: 1.6;
        }
        .header-bar {
            background-color: #ffffff;
            border-bottom: 1px solid #e2e8f0; /* Slate-200 */
            padding: 1.5rem 2rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .main-layout {
            display: flex;
            min-height: calc(100vh - 80px); /* Adjust based on header height */
        }
        .sidebar {
            width: 280px; /* Fixed width for sidebar */
            background-color: #ffffff;
            border-right: 1px solid #e2e8f0;
            padding: 2rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
            overflow-y: auto;
        }
        .content-area {
            flex-grow: 1;
            padding: 2rem;
            overflow-x: auto; /* Enable horizontal scroll for wide tables */
        }
        .container {
            max-width: 100%; /* Container takes full width of content-area */
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem;
        }
        h1 {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1e293b; /* Slate-900 */
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 1rem;
            color: #64748b; /* Slate-500 */
            margin-bottom: 1.5rem;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1.5rem;
            min-width: 800px; /* Adjusted min-width for fewer columns */
        }
        th, td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.875rem;
        }
        /* Specific style for Business Units table to allow text wrapping */
        #business-units-table td {
            white-space: normal; /* Allow text to wrap */
            word-wrap: break-word; /* Ensure long words break */
            overflow-wrap: break-word; /* Modern alternative for word-wrap */
        }
        th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #475569;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        th:first-child {
            border-top-left-radius: 0.5rem;
        }
        th:last-child {
            border-top-right-radius: 0.5rem;
        }
        th:hover {
            background-color: #eef2f6;
        }
        th.asc::after {
            content: ' ↑';
            position: absolute;
            right: 10px;
            font-size: 0.75rem;
            color: #3b82f6;
        }
        th.desc::after {
            content: ' ↓';
            position: absolute;
            right: 10px;
            font-size: 0.75rem;
            color: #3b82f6;
        }
        tbody tr:nth-child(even) {
            background-color: #fcfdfe;
        }
        tbody tr:hover {
            background-color: #f0f4f8;
        }
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            font-size: 1rem;
            color: #475569;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .filter-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }
        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .filter-section h3 {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        .filter-checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #475569;
        }
        .filter-checkbox-group input[type="checkbox"] {
            margin-right: 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid #cbd5e1;
            color: #3b82f6;
            cursor: pointer;
        }
        .column-selector-dropdown {
            position: relative;
            display: inline-block;
        }
        .column-selector-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap; /* Ensure text stays on one line */
        }
        .column-selector-button:hover {
            background-color: #2563eb;
        }
        .column-selector-content {
            display: none;
            position: absolute;
            background-color: #f9fafb;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 0.375rem;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            right: 0; /* Align to the right */
            margin-top: 0.5rem;
        }
        .column-selector-content label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #334155;
        }
        .column-selector-content input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        .column-selector-content.show {
            display: block;
        }
        .home-button {
            background-color: #64748b; /* Slate-500 */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.375rem;
            font-weight: 500;
            text-decoration: none;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .home-button:hover {
            background-color: #475569; /* Slate-600 */
        }
        .sidebar-nav-button {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: left;
            background-color: transparent;
            border: none;
            color: #475569; /* Slate-600 */
            font-weight: 500;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }
        .sidebar-nav-button:hover {
            background-color: #f0f4f8; /* Slate-100 */
            color: #1e293b; /* Slate-900 */
        }
        .sidebar-nav-button.active {
            background-color: #e2e8f0; /* Slate-200 */
            color: #1e293b; /* Slate-900 */
            font-weight: 600;
        }
        .view-section.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="max-w-7xl mx-auto flex-grow">
            <h1 class="text-3xl font-extrabold text-gray-900">Job Architecture Data Explorer</h1>
            <p class="text-gray-600">Comprehensive view of roles, skills, and organizational structure.</p>
        </div>
        <a href="/index.html" class="home-button">Back to Home</a>
    </div>

    <div class="main-layout">
        <aside class="sidebar">
            <h2 class="text-lg font-bold text-slate-800 mb-4">Navigation</h2>
            <nav>
                <ul>
                    <li><button class="sidebar-nav-button" data-target="organizations-view">Organizations</button></li>
                    <li><button class="sidebar-nav-button" data-target="business-units-view">Business Units</button></li>
                    <li><button class="sidebar-nav-button" data-target="departments-view">Departments</button></li>
                    <li><button class="sidebar-nav-button" data-target="role-groups-view">Job Families</button></li>
                    <li><button class="sidebar-nav-button" data-target="job-levels-view">Job Levels</button></li>
                    <li><button class="sidebar-nav-button active" data-target="roles-view">Job Profiles</button></li>
                </ul>
            </nav>
        </aside>

        <div class="content-area">
            <div id="roles-view" class="container view-section">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-semibold text-slate-800">All Flattened Job Architecture Roles</h2>
                        <p class="text-slate-500 text-sm">Click on column headers to sort. Use the search bar and filters to refine results.</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <input type="text" id="search-input" class="search-input" placeholder="Search roles...">
                        <div class="column-selector-dropdown">
                            <button id="column-selector-button" class="column-selector-button">
                                Select Columns
                            </button>
                            <div id="column-selector-content" class="column-selector-content">
                                <!-- Checkboxes will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters moved to main content area -->
                <div class="filter-controls flex flex-wrap items-center gap-4 mb-6">
                    <div class="filter-group">
                        <label for="filter-company-select" class="block text-sm font-medium text-slate-700">Company:</label>
                        <select id="filter-company-select" class="filter-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-business-unit-select" class="block text-sm font-medium text-slate-700">Business Unit:</label>
                        <select id="filter-business-unit-select" class="filter-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-department-select" class="block text-sm font-medium text-slate-700">Department:</label>
                        <select id="filter-department-select" class="filter-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-job-family-select" class="block text-sm font-medium text-slate-700">Job Family:</label>
                        <select id="filter-job-family-select" class="filter-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-job-level-select" class="block text-sm font-medium text-slate-700">Job Level:</label>
                        <select id="filter-job-level-select" class="filter-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-proficiency-level-select" class="block text-sm font-medium text-slate-700">Proficiency Level:</label>
                        <select id="filter-proficiency-level-select" class="filter-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></select>
                    </div>
                </div>
                
                <table id="roles-table">
                    <thead>
                        <tr id="table-header-row">
                            <!-- Headers will be dynamically inserted here -->
                        </tr>
                    </thead>
                    <tbody id="roles-table-body">
                        <!-- Roles will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- New sections for hierarchical tables -->
            <div id="organizations-view" class="container view-section hidden">
                <h2 class="text-xl font-semibold text-slate-800 mb-4">Organizations</h2>
                <table id="organizations-table">
                    <thead><tr><th>ID</th><th>Company Name</th><th>Industry</th><th>Company Size</th><th>Country</th><th>CEO</th><th>Founded Year</th><th>Revenue</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="business-units-view" class="container view-section hidden">
                <h2 class="text-xl font-semibold text-slate-800 mb-4">Business Units</h2>
                <table id="business-units-table">
                    <thead><tr><th>ID</th><th>Unit Name</th><th>Unit Head</th><th>Organization ID</th><th>Budget</th><th>Employees</th><th>Strategic Goals</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="departments-view" class="container view-section hidden">
                <h2 class="text-xl font-semibold text-slate-800 mb-4">Departments</h2>
                <table id="departments-table">
                    <thead><tr><th>ID</th><th>Department Name</th><th>Unit</th><th>Department Head</th><th>Job Function</th><th>Cost Center</th><th>Employee Count</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="role-groups-view" class="container view-section hidden">
                <h2 class="text-xl font-semibold text-slate-800 mb-4">Job Families (Role Groups)</h2>
                <table id="role-groups-table">
                    <thead><tr><th>ID</th><th>Group Name</th><th>Department</th><th>Job Family</th><th>Job Category</th><th>Grade</th><th>Compensation Range</th><th>Competencies</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="job-levels-view" class="container view-section hidden">
                <h2 class="text-xl font-semibold text-slate-800 mb-4">Job Levels</h2>
                <table id="job-levels-table">
                    <thead><tr><th>ID</th><th>Role Group ID</th><th>Level Name</th><th>Level Number</th><th>Role Level</th><th>Skill Level</th><th>Salary Range</th><th>Bonus Potential</th><th>Key Responsibilities</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const rolesTableBody = document.getElementById('roles-table-body');
            const tableHeaderRow = document.getElementById('table-header-row');
            const searchInput = document.getElementById('search-input');
            const columnSelectorButton = document.getElementById('column-selector-button');
            const columnSelectorContent = document.getElementById('column-selector-content');
            const viewSections = document.querySelectorAll('.view-section');
            const sidebarNavButtons = document.querySelectorAll('.sidebar-nav-button');

            const organizationsTableBody = document.querySelector('#organizations-table tbody');
            const businessUnitsTableBody = document.querySelector('#business-units-table tbody');
            const departmentsTableBody = document.querySelector('#departments-table tbody');
            const roleGroupsTableBody = document.querySelector('#role-groups-table tbody');
            const jobLevelsTableBody = document.querySelector('#job-levels-table tbody');

            const rawData = {
              "organizations": [
                {
                  "id": "org_akara",
                  "company_name": "Akara Airlines",
                  "industry": "Aviation",
                  "company_size": "10000+",
                  "country": "USA",
                  "ceo": "John Doe",
                  "founded_year": "1995",
                  "revenue": "$10B"
                }
              ],
              "business_units": [
                { "id": "bu_flight_ops", "unit_name": "Flight Operations", "unit_head": "Capt. Amelia Earhart", "organization_id": "org_akara", "budget": "$2.5B", "employees": "6000", "strategic_goals": "Achieve 95% on-time performance and expand routes to Southeast Asia." },
                { "id": "bu_mro", "unit_name": "Maintenance, Repair, & Overhaul (MRO)", "unit_head": "Dr. Sarah Connor", "organization_id": "org_akara", "budget": "$1.2B", "employees": "3000", "strategic_goals": "Implement predictive maintenance to reduce aircraft downtime by 15%." },
                { "id": "bu_customer_exp", "unit_name": "Customer Experience", "unit_head": "Mr. David Lee", "organization_id": "org_akara", "budget": "$800M", "employees": "4000", "strategic_goals": "Enhance passenger satisfaction score (NPS) by 20 points." },
                { "id": "bu_cargo", "unit_name": "Cargo & Logistics", "unit_head": "Ms. Emily White", "organization_id": "org_akara", "budget": "$750M", "employees": "1500", "strategic_goals": "Grow cargo market share by 10% through strategic partnerships." },
                { "id": "bu_corporate", "unit_name": "Corporate Functions", "unit_head": "Mr. Robert Green", "organization_id": "org_akara", "budget": "$300M", "employees": "800", "strategic_goals": "Digitalize HR and Finance processes to improve efficiency by 25%." },
                { "id": "bu_tech_innovation", "unit_name": "Technology & Innovation", "unit_head": "Dr. Alex Kim", "organization_id": "org_akara", "budget": "$450M", "employees": "1200", "strategic_goals": "Develop a new passenger mobile app with personalized services." }
              ],
              "departments": [
                { "id": "dept_flight_crew_ops", "department_name": "Flight Crew Operations", "unit": "bu_flight_ops", "department_head": "Capt. Alex Turner", "job_function": "Aircraft Operation", "cost_center": "FO101", "employee_count": "3500" },
                { "id": "dept_in_flight_services", "department_name": "In-Flight Services", "unit": "bu_flight_ops", "department_head": "Ms. Lisa Chen", "job_function": "In-Flight Service", "cost_center": "FO102", "employee_count": "4000" },
                { "id": "dept_airframe_maint", "department_name": "Airframe Maintenance", "unit": "bu_mro", "department_head": "Mr. Mark Davis", "job_function": "Aircraft Maintenance", "cost_center": "MRO201", "employee_count": "1500" },
                { "id": "dept_avionics_maint", "department_name": "Avionics Maintenance", "unit": "bu_mro", "department_head": "Ms. Chloe Lee", "job_function": "Aircraft Electronics", "cost_center": "MRO202", "employee_count": "800" },
                { "id": "dept_aviation_software_dev", "department_name": "Aviation Software Development", "unit": "bu_tech_innovation", "department_head": "Mr. Ben Carter", "job_function": "Software Engineering", "cost_center": "TI601", "employee_count": "600" },
                { "id": "dept_it_ops", "department_name": "IT Operations", "unit": "bu_tech_innovation", "department_head": "Ms. Sarah Jones", "job_function": "IT Infrastructure", "cost_center": "TI602", "employee_count": "400" }
              ],
              "role_groups": [
                { "id": "rg_pilot", "group_name": "Pilots", "department": "dept_flight_crew_ops", "job_family": "Flight Crew", "job_category": "Aircrew", "grade": "Senior", "compensation_range": "$100k-$300k", "competencies": "Flight Operations, Navigation, CRM" },
                { "id": "rg_flight_instructor", "group_name": "Flight Instructors", "department": "dept_flight_crew_ops", "job_family": "Flight Crew", "job_category": "Training", "grade": "Expert", "compensation_range": "$90k-$180k", "competencies": "Flight Instruction, Curriculum Development, Pilot Mentorship" },
                { "id": "rg_simulator_tech", "group_name": "Simulator Technicians", "department": "dept_flight_crew_ops", "job_family": "Flight Crew Support", "job_category": "Technical Support", "grade": "Mid-Level", "compensation_range": "$60k-$90k", "competencies": "Simulator Maintenance, Troubleshooting, Avionics Systems" },
                { "id": "rg_flight_dispatcher", "group_name": "Flight Dispatchers", "department": "dept_flight_crew_ops", "job_family": "Flight Crew Support", "job_category": "Operations Support", "grade": "Mid-Level", "compensation_range": "$55k-$85k", "competencies": "Flight Planning, Meteorology, Aviation Regulations, Communication" },
                { "id": "rg_mechanic", "group_name": "Aircraft Mechanics", "department": "dept_airframe_maint", "job_family": "Aircraft Maintenance", "job_category": "Technical", "grade": "Mid-Level", "compensation_range": "$60k-$120k", "competencies": "Aircraft Systems, Troubleshooting, Safety Protocols" },
                { "id": "rg_flight_attendant", "group_name": "Flight Attendants", "department": "dept_in_flight_services", "job_family": "Cabin Services", "job_category": "Customer Service", "grade": "Junior", "compensation_range": "$40k-$70k", "competencies": "Customer Service, Emergency Procedures, First Aid" },
                { "id": "rg_software_engineer", "group_name": "Aviation Software Engineers", "department": "dept_aviation_software_dev", "job_family": "Aviation Software Development", "job_category": "Software Engineering", "grade": "Mid-Level", "compensation_range": "$80k-$160k", "competencies": "Software Design, Coding, Testing, System Architecture" }
              ],
              "job_levels": [
                { "id": "jl_cadet_pilot", "role_group_id": "rg_pilot", "level_name": "Cadet Pilot", "level_number": "IC01", "role_level": "Individual Contributor", "skill_level": "Beginner", "salary_range": "$30k-$50k", "bonus_potential": "5%", "key_responsibilities": "Complete flight training, ground school, simulator sessions." },
                { "id": "jl_jr_first_officer", "role_group_id": "rg_pilot", "level_name": "Junior First Officer", "level_number": "IC02", "role_level": "Individual Contributor", "skill_level": "Intermediate", "salary_range": "$80k-$120k", "bonus_potential": "8%", "key_responsibilities": "Assist Captain, co-pilot duties, initial flight segments." },
                { "id": "jl_first_officer", "role_group_id": "rg_pilot", "level_name": "First Officer", "level_number": "IC03", "role_level": "Individual Contributor", "skill_level": "Advanced", "salary_range": "$120k-$180k", "bonus_potential": "12%", "key_responsibilities": "Perform co-pilot duties, manage flight systems, handle diverse routes." },
                { "id": "jl_sr_first_officer", "role_group_id": "rg_pilot", "level_name": "Senior First Officer", "level_number": "IC04", "role_level": "Individual Contributor", "skill_level": "Expert", "salary_range": "$160k-$220k", "bonus_potential": "15%", "key_responsibilities": "Mentor junior first officers, manage complex flight scenarios, act as relief pilot." },
                { "id": "jl_captain", "role_group_id": "rg_pilot", "level_name": "Captain", "level_number": "M01", "role_level": "Manager", "skill_level": "Expert", "salary_range": "$180k-$300k", "bonus_potential": "20%", "key_responsibilities": "Command aircraft, ensure safety, lead crew." },
                { "id": "jl_check_airman", "role_group_id": "rg_pilot", "level_name": "Check Airman", "level_number": "M02", "role_level": "Manager", "skill_level": "Expert", "salary_range": "$200k-$350k", "bonus_potential": "25%", "key_responsibilities": "Conduct pilot evaluations, provide advanced training, ensure regulatory compliance." },

                { "id": "jl_jr_flight_instructor", "role_group_id": "rg_flight_instructor", "level_name": "Junior Flight Instructor", "level_number": "IC01", "role_level": "Individual Contributor", "skill_level": "Intermediate", "salary_range": "$70k-$100k", "bonus_potential": "8%", "key_responsibilities": "Conduct basic flight training, evaluate student progress." },
                { "id": "jl_flight_instructor", "role_group_id": "rg_flight_instructor", "level_name": "Flight Instructor", "level_number": "IC02", "role_level": "Individual Contributor", "skill_level": "Advanced", "salary_range": "$90k-$150k", "bonus_potential": "12%", "key_responsibilities": "Provide advanced flight instruction, develop training modules." },
                { "id": "jl_chief_flight_instructor", "role_group_id": "rg_flight_instructor", "level_name": "Chief Flight Instructor", "level_number": "M01", "role_level": "Manager", "skill_level": "Expert", "salary_range": "$130k-$180k", "bonus_potential": "15%", "key_responsibilities": "Oversee flight training programs, manage instructor team." },

                { "id": "jl_jr_mechanic", "role_group_id": "rg_mechanic", "level_name": "Junior Aircraft Mechanic", "level_number": "IC01", "role_level": "Individual Contributor", "skill_level": "Beginner", "salary_range": "$45k-$65k", "bonus_potential": "5%", "key_responsibilities": "Perform routine inspections, assist senior mechanics." },
                { "id": "jl_mechanic", "role_group_id": "rg_mechanic", "level_name": "Aircraft Mechanic", "level_number": "IC02", "role_level": "Individual Contributor", "skill_level": "Intermediate", "salary_range": "$60k-$90k", "bonus_potential": "8%", "key_responsibilities": "Diagnose and repair aircraft systems, perform scheduled maintenance." },
                { "id": "jl_sr_mechanic", "role_group_id": "rg_mechanic", "level_name": "Senior Aircraft Mechanic", "level_number": "IC03", "role_level": "Individual Contributor", "skill_level": "Advanced", "salary_range": "$85k-$120k", "bonus_potential": "12%", "key_responsibilities": "Lead complex repairs, mentor junior staff, ensure compliance." },

                { "id": "jl_jr_flight_attendant", "role_group_id": "rg_flight_attendant", "level_name": "Junior Flight Attendant", "level_number": "IC01", "role_level": "Individual Contributor", "skill_level": "Beginner", "salary_range": "$40k-$55k", "bonus_potential": "3%", "key_responsibilities": "Assist passengers, serve meals, ensure cabin safety." },
                { "id": "jl_flight_attendant", "role_group_id": "rg_flight_attendant", "level_name": "Flight Attendant", "level_number": "IC02", "role_level": "Individual Contributor", "skill_level": "Intermediate", "salary_range": "$50k-$70k", "bonus_potential": "5%", "key_responsibilities": "Manage cabin, handle emergencies, provide customer service." },
                { "id": "jl_sr_flight_attendant", "role_group_id": "rg_flight_attendant", "level_name": "Senior Flight Attendant", "level_number": "IC03", "role_level": "Individual Contributor", "skill_level": "Advanced", "salary_range": "$65k-$85k", "bonus_potential": "8%", "key_responsibilities": "Lead cabin crew, manage complex situations, train new attendants." },

                { "id": "jl_jr_software_engineer", "role_group_id": "rg_software_engineer", "level_name": "Junior Aviation Software Engineer", "level_number": "IC01", "role_level": "Individual Contributor", "skill_level": "Beginner", "salary_range": "$70k-$90k", "bonus_potential": "7%", "key_responsibilities": "Write basic code, assist with testing, learn codebase." },
                { "id": "jl_software_engineer", "role_group_id": "rg_software_engineer", "level_name": "Aviation Software Engineer", "level_number": "IC02", "role_level": "Individual Contributor", "skill_level": "Intermediate", "salary_range": "$90k-$130k", "bonus_potential": "10%", "key_responsibilities": "Develop and maintain software, debug issues, contribute to design." },
                { "id": "jl_sr_software_engineer", "role_group_id": "rg_software_engineer", "level_name": "Senior Aviation Software Engineer", "level_number": "IC03", "role_level": "Individual Contributor", "skill_level": "Advanced", "salary_range": "$120k-$160k", "bonus_potential": "15%", "key_responsibilities": "Lead software projects, design complex systems, mentor junior engineers." }
              ],
              "jobs_skills": [
                {
                  "id": "js_cadet_pilot",
                  "job_title": "Cadet Pilot",
                  "core_behavioral_anchor": "Demonstrates unwavering commitment to safety and operational excellence.",
                  "associated_skills": [
                    { "skill_name": "Aerodynamics", "proficiency_level": "Beginner" },
                    { "skill_name": "Flight Theory", "proficiency_level": "Beginner" },
                    { "skill_name": "Aviation Regulations", "proficiency_level": "Beginner" },
                    { "skill_name": "Teamwork", "proficiency_level": "Intermediate" },
                    { "skill_name": "Problem Solving", "proficiency_level": "Intermediate" }
                  ],
                  "exception_override": "Must pass Class 1 Medical and aptitude tests."
                },
                {
                  "id": "js_jr_first_officer",
                  "job_title": "Junior First Officer",
                  "core_behavioral_anchor": "Applies foundational flight skills under supervision.",
                  "associated_skills": [
                    { "skill_name": "Basic Aircraft Operation", "proficiency_level": "Intermediate" },
                    { "skill_name": "Pre-flight Checks", "proficiency_level": "Intermediate" },
                    { "skill_name": "Radio Communication", "proficiency_level": "Intermediate" },
                    { "skill_name": "Flight Instrument Interpretation", "proficiency_level": "Beginner" }
                  ],
                  "exception_override": "Requires CPL (Commercial Pilot License)."
                },
                {
                  "id": "js_first_officer",
                  "job_title": "First Officer",
                  "core_behavioral_anchor": "Exhibits strong situational awareness and effective crew resource management.",
                  "associated_skills": [
                    { "skill_name": "Flight Planning", "proficiency_level": "Intermediate" },
                    { "skill_name": "Navigation", "proficiency_level": "Intermediate" },
                    { "skill_name": "Aircraft Systems", "proficiency_level": "Intermediate" },
                    { "skill_name": "Crew Resource Management", "proficiency_level": "Advanced" },
                    { "skill_name": "Emergency Procedures", "proficiency_level": "Intermediate" },
                    { "skill_name": "Crosswind Landing", "proficiency_level": "Beginner" }
                  ],
                  "exception_override": "Requires ATPL (Airline Transport Pilot License) frozen."
                },
                {
                  "id": "js_sr_first_officer",
                  "job_title": "Senior First Officer",
                  "core_behavioral_anchor": "Mentors junior crew and manages complex operational challenges.",
                  "associated_skills": [
                    { "skill_name": "Advanced Navigation", "proficiency_level": "Advanced" },
                    { "skill_name": "Complex Systems Management", "proficiency_level": "Advanced" },
                    { "skill_name": "Pilot Mentorship", "proficiency_level": "Intermediate" },
                    { "skill_name": "International Flight Procedures", "proficiency_level": "Advanced" }
                  ],
                  "exception_override": "Minimum 2000 hours as First Officer."
                },
                {
                  "id": "js_captain",
                  "job_title": "Captain",
                  "core_behavioral_anchor": "Inspires confidence and leads with decisive judgment under pressure.",
                  "associated_skills": [
                    { "skill_name": "Leadership", "proficiency_level": "Expert" },
                    { "skill_name": "Decision Making", "proficiency_level": "Expert" },
                    { "skill_name": "Risk Management", "proficiency_level": "Expert" },
                    { "skill_name": "Advanced Aircraft Systems", "proficiency_level": "Advanced" },
                    { "skill_name": "International Air Law", "proficiency_level": "Advanced" },
                    { "skill_name": "Complex Emergency Handling", "proficiency_level": "Expert" }
                  ],
                  "exception_override": "Minimum 5000 flight hours, including 1000 hours as First Officer."
                },
                {
                  "id": "js_check_airman",
                  "job_title": "Check Airman",
                  "core_behavioral_anchor": "Ensures the highest standards of pilot proficiency and regulatory compliance.",
                  "associated_skills": [
                    { "skill_name": "Pilot Evaluation", "proficiency_level": "Expert" },
                    { "skill_name": "Flight Training Standards", "proficiency_level": "Expert" },
                    { "skill_name": "Regulatory Auditing", "proficiency_level": "Advanced" },
                    { "skill_name": "Instructional Design", "proficiency_level": "Advanced" }
                  ],
                  "exception_override": "Requires FAA Check Airman designation."
                },
                {
                  "id": "js_flight_instructor",
                  "job_title": "Flight Instructor",
                  "core_behavioral_anchor": "Effectively imparts complex aviation knowledge and practical skills.",
                  "associated_skills": [
                    { "skill_name": "Flight Instruction", "proficiency_level": "Advanced" },
                    { "skill_name": "Curriculum Development", "proficiency_level": "Intermediate" },
                    { "skill_name": "Pilot Mentorship", "proficiency_level": "Advanced" },
                    { "skill_name": "Aviation Pedagogy", "proficiency_level": "Expert" }
                  ],
                  "exception_override": "Requires CFI/CFII certification."
                },
                {
                  "id": "js_simulator_technician",
                  "job_title": "Simulator Technician",
                  "core_behavioral_anchor": "Ensures optimal functionality and realism of flight simulation equipment.",
                  "associated_skills": [
                    { "skill_name": "Simulator Maintenance", "proficiency_level": "Advanced" },
                    { "skill_name": "Avionics Troubleshooting", "proficiency_level": "Intermediate" },
                    { "skill_name": "Electronic Systems Repair", "proficiency_level": "Intermediate" },
                    { "skill_name": "Diagnostic Software", "proficiency_level": "Advanced" }
                  ],
                  "exception_override": "N/A"
                },
                {
                  "id": "js_flight_dispatcher",
                  "job_title": "Flight Dispatcher",
                  "core_behavioral_anchor": "Maintains vigilant oversight of flight safety and operational efficiency.",
                  "associated_skills": [
                    { "skill_name": "Flight Planning", "proficiency_level": "Expert" },
                    { "skill_name": "Meteorology Analysis", "proficiency_level": "Advanced" },
                    { "skill_name": "Aviation Regulations", "proficiency_level": "Expert" },
                    { "skill_name": "Air Traffic Control Coordination", "proficiency_level": "Intermediate" },
                    { "skill_name": "Emergency Response Coordination", "proficiency_level": "Advanced" }
                  ],
                  "exception_override": "Requires FAA Aircraft Dispatcher Certificate."
                },
                {
                  "id": "js_jr_aircraft_mechanic",
                  "job_title": "Junior Aircraft Mechanic",
                  "core_behavioral_anchor": "Ensures meticulous attention to detail and adherence to basic safety protocols.",
                  "associated_skills": [
                    { "skill_name": "Tool Usage", "proficiency_level": "Beginner" },
                    { "skill_name": "Basic Aircraft Inspection", "proficiency_level": "Beginner" },
                    { "skill_name": "Component Identification", "proficiency_level": "Beginner" },
                    { "skill_name": "Shop Safety", "proficiency_level": "Intermediate" }
                  ],
                  "exception_override": "N/A"
                },
                {
                  "id": "js_aircraft_mechanic",
                  "job_title": "Aircraft Mechanic",
                  "core_behavioral_anchor": "Applies diagnostic skills to resolve mechanical issues efficiently.",
                  "associated_skills": [
                    { "skill_name": "Aircraft Inspection", "proficiency_level": "Intermediate" },
                    { "skill_name": "Troubleshooting", "proficiency_level": "Intermediate" },
                    { "skill_name": "Hydraulic Systems", "proficiency_level": "Intermediate" },
                    { "skill_name": "Electrical Systems", "proficiency_level": "Intermediate" },
                    { "skill_name": "Technical Documentation", "proficiency_level": "Intermediate" }
                  ],
                  "exception_override": "Requires A&P (Airframe and Powerplant) certification."
                },
                {
                  "id": "js_sr_aircraft_mechanic",
                  "job_title": "Senior Aircraft Mechanic",
                  "core_behavioral_anchor": "Leads complex maintenance operations and mentors junior technicians.",
                  "associated_skills": [
                    { "skill_name": "Advanced Troubleshooting", "proficiency_level": "Advanced" },
                    { "skill_name": "Engine Overhaul", "proficiency_level": "Advanced" },
                    { "skill_name": "Regulatory Compliance", "proficiency_level": "Expert" },
                    { "skill_name": "Team Leadership", "proficiency_level": "Advanced" },
                    { "skill_name": "Quality Assurance", "proficiency_level": "Expert" }
                  ],
                  "exception_override": "Minimum 5 years experience with A&P certification."
                },
                {
                  "id": "js_jr_flight_attendant",
                  "job_title": "Junior Flight Attendant",
                  "core_behavioral_anchor": "Provides courteous service and ensures passenger comfort.",
                  "associated_skills": [
                    { "skill_name": "Customer Service", "proficiency_level": "Intermediate" },
                    { "skill_name": "Cabin Safety Procedures", "proficiency_level": "Beginner" },
                    { "skill_name": "First Aid Basics", "proficiency_level": "Beginner" },
                    { "skill_name": "In-flight Service", "proficiency_level": "Intermediate" }
                  ],
                  "exception_override": "N/A"
                },
                {
                  "id": "js_flight_attendant",
                  "job_title": "Flight Attendant",
                  "core_behavioral_anchor": "Manages cabin environment and responds effectively to passenger needs.",
                  "associated_skills": [
                    { "skill_name": "Customer Service", "proficiency_level": "Advanced" },
                    { "skill_name": "Emergency Response", "proficiency_level": "Intermediate" },
                    { "skill_name": "First Aid", "proficiency_level": "Intermediate" },
                    { "skill_name": "Communication", "proficiency_level": "Advanced" },
                    { "skill_name": "Conflict Resolution", "proficiency_level": "Intermediate" }
                  ],
                  "exception_override": "Must pass recurrent safety training annually."
                },
                {
                  "id": "js_sr_flight_attendant",
                  "job_title": "Senior Flight Attendant",
                  "core_behavioral_anchor": "Leads cabin crew with composure and expertise in all situations.",
                  "associated_skills": [
                    { "skill_name": "Cabin Crew Leadership", "proficiency_level": "Advanced" },
                    { "skill_name": "Advanced Emergency Procedures", "proficiency_level": "Expert" },
                    { "skill_name": "Crisis Management", "proficiency_level": "Advanced" },
                    { "skill_name": "Training & Mentoring", "proficiency_level": "Intermediate" },
                    { "skill_name": "International Service Protocols", "proficiency_level": "Advanced" }
                  ],
                  "exception_override": "Minimum 3 years experience as Flight Attendant."
                },
                {
                  "id": "js_jr_aviation_software_engineer",
                  "job_title": "Junior Aviation Software Engineer",
                  "core_behavioral_anchor": "Applies foundational coding skills to develop robust aviation software.",
                  "associated_skills": [
                    { "skill_name": "Python", "proficiency_level": "Beginner" },
                    { "skill_name": "JavaScript", "proficiency_level": "Beginner" },
                    { "skill_name": "Version Control (Git)", "proficiency_level": "Intermediate" },
                    { "skill_name": "Unit Testing", "proficiency_level": "Beginner" },
                    { "skill_name": "Data Structures", "proficiency_level": "Beginner" }
                  ],
                  "exception_override": "N/A"
                },
                {
                  "id": "js_aviation_software_engineer",
                  "job_title": "Aviation Software Engineer",
                  "core_behavioral_anchor": "Designs and implements scalable software solutions for aviation systems.",
                  "associated_skills": [
                    { "skill_name": "Python", "proficiency_level": "Intermediate" },
                    { "skill_name": "JavaScript", "proficiency_level": "Intermediate" },
                    { "skill_name": "Cloud Platforms (AWS/Azure)", "proficiency_level": "Beginner" },
                    { "skill_name": "Database Design (SQL/NoSQL)", "proficiency_level": "Intermediate" },
                    { "skill_name": "API Development", "proficiency_level": "Intermediate" },
                    { "skill_name": "Agile Methodologies", "proficiency_level": "Intermediate" }
                  ],
                  "exception_override": "N/A"
                },
                {
                  "id": "js_sr_aviation_software_engineer",
                  "job_title": "Senior Aviation Software Engineer",
                  "core_behavioral_anchor": "Architects and leads the development of critical aviation software infrastructure.",
                  "associated_skills": [
                    { "skill_name": "System Architecture", "proficiency_level": "Advanced" },
                    { "skill_name": "Cloud Security", "proficiency_level": "Advanced" },
                    { "skill_name": "Distributed Systems", "proficiency_level": "Advanced" },
                    { "skill_name": "DevOps Practices", "proficiency_level": "Expert" },
                    { "skill_name": "Mentorship", "proficiency_level": "Advanced" },
                    { "skill_name": "Requirements Analysis", "proficiency_level": "Expert" }
                  ],
                  "exception_override": "Minimum 5 years experience in aviation software development."
                }
              ]
            };

            let flattenedData = [];

            // Flatten the data
            rawData.jobs_skills.forEach(jobSkill => {
                const jobLevel = rawData.job_levels.find(jl => jl.id === jobSkill.id.replace('js_', 'jl_'));
                const roleGroup = jobLevel ? rawData.role_groups.find(rg => rg.id === jobLevel.role_group_id) : null;
                const department = roleGroup ? rawData.departments.find(d => d.id === roleGroup.department) : null;
                const businessUnit = department ? rawData.business_units.find(bu => bu.id === department.unit) : null;
                const organization = businessUnit ? rawData.organizations.find(org => org.id === businessUnit.organization_id) : null;

                jobSkill.associated_skills.forEach(skill => {
                    flattenedData.push({
                        // Organization Columns
                        organization_id: organization ? organization.id : '',
                        company_name: organization ? organization.company_name : '',
                        industry: organization ? organization.industry : '',
                        company_size: organization ? organization.company_size : '',
                        country: organization ? organization.country : '',
                        ceo: organization ? organization.ceo : '',
                        founded_year: organization ? organization.founded_year : '',
                        revenue: organization ? organization.revenue : '',

                        // Business Unit Columns
                        business_unit_id: businessUnit ? businessUnit.id : '',
                        unit_name: businessUnit ? businessUnit.unit_name : '',
                        unit_head: businessUnit ? businessUnit.unit_head : '',
                        budget: businessUnit ? businessUnit.budget : '',
                        business_unit_employees: businessUnit ? businessUnit.employees : '',
                        strategic_goals: businessUnit ? businessUnit.strategic_goals : '',

                        // Department Columns
                        department_id: department ? department.id : '',
                        department_name: department ? department.department_name : '',
                        department_head: department ? department.department_head : '',
                        job_function: department ? department.job_function : '',
                        cost_center: department ? department.cost_center : '',
                        department_employee_count: department ? department.employee_count : '',

                        // Role Group Columns
                        role_group_id: roleGroup ? roleGroup.id : '',
                        group_name: roleGroup ? roleGroup.group_name : '',
                        job_family: roleGroup ? roleGroup.job_family : '',
                        job_category: roleGroup ? roleGroup.job_category : '',
                        grade: roleGroup ? roleGroup.grade : '',
                        compensation_range: roleGroup ? roleGroup.compensation_range : '',
                        competencies: roleGroup ? roleGroup.competencies : '',

                        // Job Level Columns
                        job_level_id: jobLevel ? jobLevel.id : '',
                        level_name: jobLevel ? jobLevel.level_name : '',
                        level_number: jobLevel ? jobLevel.level_number : '',
                        role_level: jobLevel ? jobLevel.role_level : '',
                        overall_skill_level: jobLevel ? jobLevel.skill_level : '',
                        salary_range: jobLevel ? jobLevel.salary_range : '',
                        bonus_potential: jobLevel ? jobLevel.bonus_potential : '',
                        key_responsibilities: jobLevel ? jobLevel.key_responsibilities : '',

                        // Job Skill Columns
                        job_title: jobSkill.job_title,
                        core_behavioral_anchor: jobSkill.core_behavioral_anchor,
                        exception_override: jobSkill.exception_override,
                        skill_name: skill.skill_name,
                        proficiency_level: skill.proficiency_level
                    });
                });
            });

            const allColumns = [
                { key: 'organization_id', label: 'Org ID', defaultVisible: false },
                { key: 'company_name', label: 'Company Name', defaultVisible: true },
                { key: 'industry', label: 'Industry', defaultVisible: false },
                { key: 'company_size', label: 'Company Size', defaultVisible: false },
                { key: 'country', label: 'Country', defaultVisible: false },
                { key: 'ceo', label: 'CEO', defaultVisible: false },
                { key: 'founded_year', label: 'Founded Year', defaultVisible: false },
                { key: 'revenue', label: 'Revenue', defaultVisible: false },
                { key: 'business_unit_id', label: 'BU ID', defaultVisible: false },
                { key: 'unit_name', label: 'Business Unit', defaultVisible: true },
                { key: 'unit_head', label: 'Unit Head', defaultVisible: false },
                { key: 'budget', label: 'Budget', defaultVisible: false },
                { key: 'business_unit_employees', label: 'BU Employees', defaultVisible: false },
                { key: 'strategic_goals', label: 'Strategic Goals', defaultVisible: false },
                { key: 'department_id', label: 'Dept ID', defaultVisible: false },
                { key: 'department_name', label: 'Department Name', defaultVisible: true },
                { key: 'department_head', label: 'Dept Head', defaultVisible: false },
                { key: 'job_function', label: 'Job Function', defaultVisible: false },
                { key: 'cost_center', label: 'Cost Center', defaultVisible: false },
                { key: 'department_employee_count', label: 'Dept Employees', defaultVisible: false },
                { key: 'role_group_id', label: 'Job Family ID', defaultVisible: false },
                { key: 'group_name', label: 'Job Family Name', defaultVisible: true },
                { key: 'job_family', label: 'Job Family', defaultVisible: false },
                { key: 'job_category', label: 'Job Category', defaultVisible: false },
                { key: 'grade', label: 'Grade', defaultVisible: false },
                { key: 'compensation_range', label: 'Compensation Range', defaultVisible: false },
                { key: 'competencies', label: 'Competencies (Group)', defaultVisible: false },
                { key: 'job_level_id', label: 'Job Level ID', defaultVisible: false },
                { key: 'level_name', label: 'Level Name', defaultVisible: true },
                { key: 'level_number', label: 'Level Number', defaultVisible: false },
                { key: 'role_level', label: 'Role Level', defaultVisible: false },
                { key: 'overall_skill_level', label: 'Overall Skill Level', defaultVisible: false },
                { key: 'salary_range', label: 'Salary Range', defaultVisible: false },
                { key: 'bonus_potential', label: 'Bonus Potential', defaultVisible: false },
                { key: 'key_responsibilities', label: 'Key Responsibilities', defaultVisible: false },
                { key: 'job_title', label: 'Job Title', defaultVisible: true },
                { key: 'core_behavioral_anchor', label: 'Core Behavioral Anchor', defaultVisible: false },
                { key: 'exception_override', label: 'Exception Override', defaultVisible: false },
                { key: 'skill_name', label: 'Skill Name', defaultVisible: false },
                { key: 'proficiency_level', label: 'Proficiency Level', defaultVisible: false }
            ];

            let visibleColumns = allColumns.filter(col => col.defaultVisible).map(col => col.key);
            let currentSortColumn = null;
            let sortDirection = 'asc'; // 'asc' or 'desc'
            let filteredData = [...flattenedData]; // Data to be rendered, initially all data

            const activeFilters = {
                company_name: 'All',
                unit_name: 'All',
                department_name: 'All',
                group_name: 'All',
                level_name: 'All',
                proficiency_level: 'All'
            };

            function populateFilters() {
                const filterSelects = {
                    company_name: document.getElementById('filter-company-select'),
                    unit_name: document.getElementById('filter-business-unit-select'),
                    department_name: document.getElementById('filter-department-select'),
                    group_name: document.getElementById('filter-job-family-select'),
                    level_name: document.getElementById('filter-job-level-select'),
                    proficiency_level: document.getElementById('filter-proficiency-level-select')
                };

                for (const key in filterSelects) {
                    const values = new Set(flattenedData.map(item => item[key]).filter(Boolean)); // Get unique non-empty values
                    const selectElement = filterSelects[key];
                    selectElement.innerHTML = '<option value="All">All</option>'; // Add default "All" option
                    values.forEach(value => {
                        const option = document.createElement('option');
                        option.value = value;
                        option.textContent = value;
                        selectElement.appendChild(option);
                    });

                    selectElement.addEventListener('change', (event) => {
                        activeFilters[key] = event.target.value;
                        applyFiltersAndRender();
                    });
                }
            }

            function populateColumnSelector() {
                columnSelectorContent.innerHTML = '';
                allColumns.forEach(col => {
                    const isChecked = visibleColumns.includes(col.key) ? 'checked' : '';
                    columnSelectorContent.innerHTML += `
                        <label>
                            <input type="checkbox" class="column-toggle-checkbox" value="${col.key}" ${isChecked} />
                            ${col.label}
                        </label>
                    `;
                });

                document.querySelectorAll('.column-toggle-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (event) => {
                        const columnKey = event.target.value;
                        if (event.target.checked) {
                            if (!visibleColumns.includes(columnKey)) {
                                visibleColumns.push(columnKey);
                            }
                        } else {
                            visibleColumns = visibleColumns.filter(key => key !== columnKey);
                        }
                        // Re-sort visible columns based on their original order in allColumns
                        visibleColumns.sort((a, b) => {
                            const indexA = allColumns.findIndex(col => col.key === a);
                            const indexB = allColumns.findIndex(col => col.key === b);
                            return indexA - indexB;
                        });
                        applyFiltersAndRender(); // Re-render table with new columns
                    });
                });
            }

            function renderTable(data) {
                tableHeaderRow.innerHTML = '';
                rolesTableBody.innerHTML = '';

                // Render headers
                visibleColumns.forEach(key => {
                    const columnDef = allColumns.find(col => col.key === key);
                    if (columnDef) {
                        const th = document.createElement('th');
                        th.setAttribute('data-sort', key);
                        th.textContent = columnDef.label;
                        if (currentSortColumn === key) {
                            th.classList.add(sortDirection);
                        }
                        tableHeaderRow.appendChild(th);
                    }
                });

                // Add event listeners to new headers
                document.querySelectorAll('#table-header-row th').forEach(header => {
                    header.addEventListener('click', (event) => {
                        const column = event.target.getAttribute('data-sort');
                        if (column) {
                            sortData(column);
                        }
                    });
                });

                // Render rows
                if (data.length === 0) {
                    rolesTableBody.innerHTML = `<tr><td colspan="${visibleColumns.length}" class="text-center py-4 text-slate-500">No matching roles found.</td></tr>`;
                    return;
                }
                data.forEach(item => {
                    const row = rolesTableBody.insertRow();
                    visibleColumns.forEach(key => {
                        const cell = row.insertCell();
                        let cellContent = item[key];
                        if (key === 'associated_skills' && Array.isArray(item[key])) {
                            cellContent = item[key].map(s => `${s.skill_name} (${s.proficiency_level})`).join(', ');
                        }
                        cell.textContent = cellContent || ''; // Display empty string for null/undefined
                    });
                });
            }

            function sortData(column) {
                const isNumeric = (value) => {
                    if (typeof value === 'string') {
                        const cleanedValue = value.replace(/[^0-9.-]+/g, '');
                        return !isNaN(parseFloat(cleanedValue)) && isFinite(cleanedValue);
                    }
                    return !isNaN(parseFloat(value)) && isFinite(value);
                };

                if (currentSortColumn === column) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortColumn = column;
                    sortDirection = 'asc';
                }

                filteredData.sort((a, b) => {
                    let valA = a[column];
                    let valB = b[column];

                    if (valA === null || valA === undefined) valA = '';
                    if (valB === null || valB === undefined) valB = '';

                    if (isNumeric(valA) && isNumeric(valB)) {
                        const numA = parseFloat(String(valA).replace(/[^0-9.-]+/g, ''));
                        const numB = parseFloat(String(valB).replace(/[^0-9.-]+/g, ''));
                        return sortDirection === 'asc' ? numA - numB : numB - numA;
                    } else {
                        const comparison = String(valA).localeCompare(String(valB));
                        return sortDirection === 'asc' ? comparison : -comparison;
                    }
                });
                renderTable(filteredData);
            }

            function applyFiltersAndRender() {
                const searchTerm = searchInput.value.toLowerCase();
                
                filteredData = flattenedData.filter(item => {
                    // Text search filter across all data fields (even hidden ones)
                    const matchesSearch = Object.values(item).some(value => 
                        String(value).toLowerCase().includes(searchTerm)
                    );

                    // Dropdown filters
                    const matchesDropdowns = Object.keys(activeFilters).every(filterKey => {
                        const filterValue = activeFilters[filterKey];
                        if (filterValue === 'All') {
                            return true; // "All" selected, so this filter doesn't apply
                        }
                        return item[filterKey] === filterValue;
                    });

                    return matchesSearch && matchesDropdowns;
                });

                // Re-sort after filtering if a sort column is active
                if (currentSortColumn) {
                    sortData(currentSortColumn); // This will also call renderTable
                } else {
                    renderTable(filteredData);
                }
            }

            function renderOrganizationsTable(data) {
                organizationsTableBody.innerHTML = '';
                data.forEach(item => {
                    const row = organizationsTableBody.insertRow();
                    row.insertCell().textContent = item.id;
                    row.insertCell().textContent = item.company_name;
                    row.insertCell().textContent = item.industry;
                    row.insertCell().textContent = item.company_size;
                    row.insertCell().textContent = item.country;
                    row.insertCell().textContent = item.ceo;
                    row.insertCell().textContent = item.founded_year;
                    row.insertCell().textContent = item.revenue;
                });
            }

            function renderBusinessUnitsTable(data) {
                businessUnitsTableBody.innerHTML = '';
                data.forEach(item => {
                    const row = businessUnitsTableBody.insertRow();
                    row.insertCell().textContent = item.id;
                    row.insertCell().textContent = item.unit_name;
                    row.insertCell().textContent = item.unit_head;
                    row.insertCell().textContent = item.organization_id;
                    row.insertCell().textContent = item.budget;
                    row.insertCell().textContent = item.employees;
                    row.insertCell().textContent = item.strategic_goals;
                });
            }

            function renderDepartmentsTable(data) {
                departmentsTableBody.innerHTML = '';
                data.forEach(item => {
                    const row = departmentsTableBody.insertRow();
                    row.insertCell().textContent = item.id;
                    row.insertCell().textContent = item.department_name;
                    row.insertCell().textContent = item.unit;
                    row.insertCell().textContent = item.department_head;
                    row.insertCell().textContent = item.job_function;
                    row.insertCell().textContent = item.cost_center;
                    row.insertCell().textContent = item.employee_count;
                });
            }

            function renderRoleGroupsTable(data) {
                roleGroupsTableBody.innerHTML = '';
                data.forEach(item => {
                    const row = roleGroupsTableBody.insertRow();
                    row.insertCell().textContent = item.id;
                    row.insertCell().textContent = item.group_name;
                    row.insertCell().textContent = item.department;
                    row.insertCell().textContent = item.job_family;
                    row.insertCell().textContent = item.job_category;
                    row.insertCell().textContent = item.grade;
                    row.insertCell().textContent = item.compensation_range;
                    row.insertCell().textContent = item.competencies;
                });
            }

            function renderJobLevelsTable(data) {
                jobLevelsTableBody.innerHTML = '';
                data.forEach(item => {
                    const row = jobLevelsTableBody.insertRow();
                    row.insertCell().textContent = item.id;
                    row.insertCell().textContent = item.role_group_id;
                    row.insertCell().textContent = item.level_name;
                    row.insertCell().textContent = item.level_number;
                    row.insertCell().textContent = item.role_level;
                    row.insertCell().textContent = item.skill_level;
                    row.insertCell().textContent = item.salary_range;
                    row.insertCell().textContent = item.bonus_potential;
                    row.insertCell().textContent = item.key_responsibilities;
                });
            }

            function showView(viewId) {
                viewSections.forEach(section => {
                    if (section.id === viewId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });

                sidebarNavButtons.forEach(button => {
                    if (button.dataset.target === viewId) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });

                // Render data for the active view
                if (viewId === 'roles-view') {
                    applyFiltersAndRender(); // Re-render flattened roles with current filters
                } else if (viewId === 'organizations-view') {
                    renderOrganizationsTable(rawData.organizations);
                } else if (viewId === 'business-units-view') {
                    renderBusinessUnitsTable(rawData.business_units);
                } else if (viewId === 'departments-view') {
                    renderDepartmentsTable(rawData.departments);
                } else if (viewId === 'role-groups-view') {
                    renderRoleGroupsTable(rawData.role_groups);
                } else if (viewId === 'job-levels-view') {
                    renderJobLevelsTable(rawData.job_levels);
                }
            }

            // Toggle column selector dropdown
            columnSelectorButton.addEventListener('click', () => {
                columnSelectorContent.classList.toggle('show');
            });

            // Close the dropdown if the user clicks outside of it
            window.addEventListener('click', (event) => {
                if (!event.target.matches('#column-selector-button') && !columnSelectorContent.contains(event.target)) {
                    columnSelectorContent.classList.remove('show');
                }
            });

            // Add event listeners for sidebar navigation
            sidebarNavButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    showView(event.target.dataset.target);
                });
            });

            // Initial setup
            populateFilters();
            populateColumnSelector();
            showView('roles-view'); // Show flattened roles by default
        });
    </script>
</body>
</html>
